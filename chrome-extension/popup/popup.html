<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SubTracker - Subscription Management Extension</title>
  <link rel="stylesheet" href="popup-minimal.css">
  <link rel="stylesheet" href="popup-form-new.css">
</head>
<body>
  <div class="container">
    <!-- Header -->
    <header class="header">
      <div class="logo">
        <div class="logo-icon">S</div>
        <h1>SubTracker</h1>
      </div>
      <button id="settingsBtn" class="settings-btn" title="Settings" aria-label="Open settings">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
          <path d="M12 15A3 3 0 1 0 12 9A3 3 0 0 0 12 15Z" stroke="currentColor" stroke-width="2"/>
          <path d="M19.4 15A1.65 1.65 0 0 0 18 13.34A1.65 1.65 0 0 0 19.4 9A2.15 2.15 0 0 1 21.5 7A2.15 2.15 0 0 1 19.4 5A1.65 1.65 0 0 0 18 3.34A1.65 1.65 0 0 0 19.4 1A2.15 2.15 0 0 1 17 0A2.15 2.15 0 0 1 15.6 1A1.65 1.65 0 0 0 14.34 3.34A1.65 1.65 0 0 0 12 5A1.65 1.65 0 0 0 9.66 3.34A1.65 1.65 0 0 0 8.4 1A2.15 2.15 0 0 1 6 0A2.15 2.15 0 0 1 4.6 1A1.65 1.65 0 0 0 3.34 3.34A1.65 1.65 0 0 0 4.6 9A2.15 2.15 0 0 1 2.5 7A2.15 2.15 0 0 1 4.6 15A1.65 1.65 0 0 0 6 13.34A1.65 1.65 0 0 0 4.6 19A2.15 2.15 0 0 1 7 21A2.15 2.15 0 0 1 9.66 19A1.65 1.65 0 0 0 12 20.66A1.65 1.65 0 0 0 14.34 19A1.65 1.65 0 0 0 15.6 21A2.15 2.15 0 0 1 17 21A2.15 2.15 0 0 1 19.4 19A1.65 1.65 0 0 0 20.66 20.66A1.65 1.65 0 0 0 19.4 15Z" stroke="currentColor" stroke-width="2"/>
        </svg>
      </button>
    </header>

    <!-- Auth Section -->
    <div id="authSection" class="auth-section hidden">
      <div class="auth-form">
        <h2>Connect to Your Account</h2>
        <p class="auth-description">Enter your Subscription Tracker URL and API key to sync your data.</p>
        
        <div class="form-group">
          <label for="apiUrl">App URL:</label>
          <input type="url" id="apiUrl" placeholder="https://3b09af3c-f605-44fe-8597-73a8f24d40cc-00-2xkffllmc9j6n.kirk.replit.dev" required aria-describedby="apiUrl-hint" />
        </div>
        
        <div class="form-group">
          <label for="apiKey">API Key:</label>
          <input type="password" id="apiKey" placeholder="dev-api-key" required aria-describedby="apiKey-hint" />
          <small id="apiKey-hint"><strong>Demo:</strong> Use "dev-api-key" for testing</small>
        </div>
        
        <button id="connectBtn" class="connect-btn" aria-label="Connect to your subscription tracker account">Connect Account</button>
      </div>
    </div>

    <!-- Main Content -->
    <div id="mainContent" class="main-content hidden">
      <!-- Navigation Tabs -->
      <nav class="nav-tabs" role="tablist" aria-label="Main navigation">
        <button class="nav-tab active" data-tab="dashboard" role="tab" aria-selected="true" aria-controls="dashboardTab">Dashboard</button>
        <button class="nav-tab" data-tab="calendar" role="tab" aria-selected="false" aria-controls="calendarTab">Calendar</button>
        <button class="nav-tab" data-tab="insights" role="tab" aria-selected="false" aria-controls="insightsTab">Insights</button>
        <button class="nav-tab" data-tab="reminders" role="tab" aria-selected="false" aria-controls="remindersTab">Reminders</button>
      </nav>

      <!-- Dashboard Tab -->
      <div id="dashboardTab" class="tab-content active" role="tabpanel" aria-labelledby="dashboard-tab">
        <!-- Stats Overview -->
        <div class="stats-section" role="region" aria-label="Subscription statistics">
          <div class="stat-card" tabindex="0" data-tooltip="Your total monthly spending">
            <div class="stat-value" id="totalCost" aria-live="polite">$0.00</div>
            <div class="stat-label">Monthly Total</div>
          </div>
          <div class="stat-card" tabindex="0" data-tooltip="Number of active subscriptions">
            <div class="stat-value" id="activeCount" aria-live="polite">0</div>
            <div class="stat-label">Active Subs</div>
          </div>
          <div class="stat-card" tabindex="0" data-tooltip="Subscriptions renewing within 7 days">
            <div class="stat-value" id="upcomingCount" aria-live="polite">0</div>
            <div class="stat-label">Due Soon</div>
          </div>
        </div>

        <!-- Search and Filter -->
        <div class="search-section" role="search">
          <div class="search-bar">
            <input type="text" id="searchInput" placeholder="Search subscriptions..." aria-label="Search subscriptions" />
            <button id="searchBtn" class="search-btn" aria-label="Execute search">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
                <circle cx="11" cy="11" r="8"/>
                <path d="m21 21-4.35-4.35"/>
              </svg>
            </button>
          </div>
          <div class="filter-chips">
            <button class="filter-chip active" data-filter="all">All</button>
            <button class="filter-chip" data-filter="active">Active</button>
            <button class="filter-chip" data-filter="due-soon">Due Soon</button>
          </div>
        </div>

        <!-- Quick Actions -->
        <div class="actions-section" role="toolbar" aria-label="Quick actions">
          <button id="addSubBtn" class="action-btn primary" aria-label="Add new subscription">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
              <path d="M12 5V19" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <path d="M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
            Add Subscription
          </button>
          <button id="syncBtn" class="action-btn secondary" aria-label="Synchronize data">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" aria-hidden="true">
              <path d="M21 12A9 9 0 1 1 12 3" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <path d="M21 3V12H12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
            Sync Now
          </button>
        </div>

        <!-- Subscriptions List -->
        <div class="subscriptions-section">
          <div class="section-header">
            <h3>Your Subscriptions</h3>
            <button id="viewAllBtn" class="view-all-btn">View All</button>
          </div>
          <div id="subscriptionsList" class="subscriptions-list">
            <div class="loading-state">Loading subscriptions...</div>
          </div>
        </div>
      </div>

      <!-- Calendar Tab -->
      <div id="calendarTab" class="tab-content">
        <div class="calendar-header">
          <button id="prevMonth" class="calendar-nav">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="15,18 9,12 15,6"/>
            </svg>
          </button>
          <h3 id="calendarTitle">January 2025</h3>
          <button id="nextMonth" class="calendar-nav">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="9,18 15,12 9,6"/>
            </svg>
          </button>
        </div>
        
        <div class="calendar-grid">
          <div class="calendar-day-header">S</div>
          <div class="calendar-day-header">M</div>
          <div class="calendar-day-header">T</div>
          <div class="calendar-day-header">W</div>
          <div class="calendar-day-header">T</div>
          <div class="calendar-day-header">F</div>
          <div class="calendar-day-header">S</div>
        </div>
        
        <div id="calendarDays" class="calendar-days"></div>
        
        <div class="upcoming-section">
          <h4>Upcoming Renewals (Next 30 Days)</h4>
          <div id="upcomingRenewals" class="upcoming-list">
            <div class="loading-state">Loading upcoming renewals...</div>
          </div>
        </div>
      </div>

      <!-- Insights Tab -->
      <div id="insightsTab" class="tab-content">
        <div class="insights-section">
          <h3>Spending Analysis</h3>
          
          <div class="spending-chart">
            <div class="chart-header">
              <h4>Monthly Breakdown</h4>
              <div id="totalSpending" class="total-spending">346.00</div>
            </div>
            <div id="categoryChart" class="category-chart">
              <div class="category-item">
                <div class="category-color" style="background: #3b82f6;"></div>
                <div class="category-info">
                  <div class="category-name">Entertainment</div>
                  <div class="category-amount">$15.99</div>
                  <div class="category-percentage">45%</div>
                </div>
                <div class="spending-bar">
                  <div class="spending-progress" style="width: 45%;"></div>
                </div>
              </div>

              <div class="category-item">
                <div class="category-color" style="background: #10b981;"></div>
                <div class="category-info">
                  <div class="category-name">Productivity</div>
                  <div class="category-amount">$12.99</div>
                  <div class="category-percentage">37%</div>
                </div>
                <div class="spending-bar">
                  <div class="spending-progress" style="width: 37%;"></div>
                </div>
              </div>

              <div class="category-item">
                <div class="category-color" style="background: #f59e0b;"></div>
                <div class="category-info">
                  <div class="category-name">Cloud Storage</div>
                  <div class="category-amount">$2.99</div>
                  <div class="category-percentage">8%</div>
                </div>
                <div class="spending-bar">
                  <div class="spending-progress" style="width: 8%;"></div>
                </div>
              </div>

              <div class="category-item">
                <div class="category-color" style="background: #ef4444;"></div>
                <div class="category-info">
                  <div class="category-name">Music</div>
                  <div class="category-amount">$3.50</div>
                  <div class="category-percentage">10%</div>
                </div>
                <div class="spending-bar">
                  <div class="spending-progress" style="width: 10%;"></div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="insights-cards">
            <div class="insight-card">
              <h4>Most Expensive</h4>
              <div id="mostExpensive" class="insight-value">Netflix</div>
            </div>
            <div class="insight-card">
              <h4>Average Cost</h4>
              <div id="averageCost" class="insight-value">$14.42</div>
            </div>
            <div class="insight-card">
              <h4>This Year Total</h4>
              <div id="yearlyTotal" class="insight-value">$173.04</div>
            </div>
          </div>
          
          <div class="recommendations">
            <h4>Smart Recommendations</h4>
            <div id="recommendationsList" class="recommendations-list">
              <div class="recommendation-item">
                <div class="rec-content">
                  You're spending $346.00/month on subscriptions. Consider reviewing unused services.
                </div>
              </div>
              <div class="recommendation-item">
                <div class="rec-content">
                  Switch Netflix to annual billing - save $24/year compared to monthly payments.
                </div>
              </div>
              <div class="recommendation-item">
                <div class="rec-content">
                  Your cloud storage is 85% full. Consider cleaning up old files to avoid upgrade costs.
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>


    <!-- Modal Overlay for New Subscription Form -->
    <div id="addFormModal" class="modal-overlay hidden">
      <div class="subscription-form">
        <!-- Purple Gradient Header -->
        <div class="form-header">
          <h2>Add New Subscription</h2>
          <button id="closeAddForm" class="close-btn" aria-label="Close">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"/>
              <line x1="6" y1="6" x2="18" y2="18"/>
            </svg>
          </button>
        </div>

        <!-- Tab Navigation -->
        <div class="form-tabs">
          <button class="form-tab active" data-tab="basic">Basic Info</button>
          <button class="form-tab" data-tab="advanced">Advanced</button>
        </div>

        <!-- Form Body -->
        <div class="form-body">
          <!-- Basic Info Tab -->
          <div class="tab-panel active" id="basic-panel">
            <!-- Name and Cost Row -->
            <div class="form-grid">
              <div class="form-field">
                <label class="field-label">
                  Service Name <span class="required-mark">*</span>
                </label>
                <input type="text" id="subName" class="field-input" placeholder="e.g., Netflix, Spotify" required>
                <span class="field-error">Service name is required</span>
              </div>
              
              <div class="form-field">
                <label class="field-label">
                  Cost <span class="required-mark">*</span>
                </label>
                <div class="currency-field">
                  <span class="currency-prefix">$</span>
                  <input type="number" id="subCost" class="field-input" placeholder="9.99" step="0.01" min="0" required>
                </div>
                <span class="field-error">Please enter a valid cost</span>
              </div>
            </div>

            <!-- Category and Billing Cycle Row -->
            <div class="form-grid">
              <div class="form-field">
                <label class="field-label">Category</label>
                <select id="subCategory" class="field-select">
                  <option value="">Select category</option>
                  <option value="entertainment">Entertainment</option>
                  <option value="productivity">Productivity</option>
                  <option value="music">Music & Audio</option>
                  <option value="software">Software Tools</option>
                  <option value="cloud">Cloud Storage</option>
                  <option value="fitness">Health & Fitness</option>
                  <option value="education">Education</option>
                  <option value="news">News & Media</option>
                  <option value="gaming">Gaming</option>
                  <option value="other">Other</option>
                </select>
              </div>
              
              <div class="form-field">
                <label class="field-label">Billing Cycle</label>
                <select id="subCycle" class="field-select">
                  <option value="monthly">Monthly</option>
                  <option value="yearly">Yearly</option>
                  <option value="weekly">Weekly</option>
                  <option value="quarterly">Quarterly</option>
                </select>
              </div>
            </div>

            <!-- Next Billing Date and Status -->
            <div class="form-grid">
              <div class="form-field">
                <label class="field-label">Next Billing Date</label>
                <input type="date" id="nextBillingDate" class="field-input">
                <span class="field-help">When is your next renewal?</span>
              </div>
              
              <div class="form-field">
                <label class="field-label">Status</label>
                <div class="switch-group">
                  <label class="switch">
                    <input type="checkbox" id="isActive" class="switch-input" checked>
                    <span class="switch-slider"></span>
                  </label>
                  <span class="switch-label">Active subscription</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Advanced Tab -->
          <div class="tab-panel" id="advanced-panel">
            <!-- Email and URL Row -->
            <div class="form-grid">
              <div class="form-field">
                <label class="field-label">Account Email</label>
                <input type="email" id="subEmail" class="field-input" placeholder="email@example.com">
                <span class="field-help">Email for this service</span>
              </div>
              
              <div class="form-field">
                <label class="field-label">Website URL</label>
                <input type="url" id="subUrl" class="field-input" placeholder="https://example.com">
                <span class="field-help">Service website</span>
              </div>
            </div>

            <!-- Notes -->
            <div class="form-grid single">
              <div class="form-field">
                <label class="field-label">Description</label>
                <textarea id="subDescription" class="field-textarea" placeholder="Add notes about this subscription..."></textarea>
                <span class="field-help" style="text-align: right;">0 / 200 characters</span>
              </div>
            </div>

            <!-- Priority Level -->
            <div class="form-grid single">
              <div class="form-field">
                <label class="field-label">Priority Level</label>
                <div class="priority-pills" id="priorityPills">
                  <button class="priority-pill low" data-priority="low">Low</button>
                  <button class="priority-pill medium" data-priority="medium">Medium</button>
                  <button class="priority-pill high active" data-priority="high">High</button>
                  <button class="priority-pill" data-priority="essential">Essential</button>
                </div>
                <input type="hidden" id="subPriority" value="high">
              </div>
            </div>

            <!-- Budget and Notifications -->
            <div class="form-grid">
              <div class="form-field">
                <label class="field-label">Budget Limit</label>
                <div class="currency-field">
                  <span class="currency-prefix">$</span>
                  <input type="number" id="subBudgetLimit" class="field-input" placeholder="50.00" step="0.01" min="0">
                </div>
                <span class="field-help">Monthly spending limit</span>
              </div>
              
              <div class="form-field">
                <label class="field-label">Notifications</label>
                <div style="display: flex; flex-direction: column; gap: 10px;">
                  <div class="checkbox-group">
                    <input type="checkbox" class="checkbox-input" id="sendReminders" checked>
                    <label for="sendReminders" class="checkbox-label">Email reminders</label>
                  </div>
                  <div class="checkbox-group">
                    <input type="checkbox" class="checkbox-input" id="trackUsage">
                    <label for="trackUsage" class="checkbox-label">Track usage</label>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Form Footer -->
        <div class="form-footer">
          <button id="cancelSubBtn" class="btn btn-secondary">Cancel</button>
          <button id="saveSubBtn" class="btn btn-primary">Save Subscription</button>
        </div>
      </div>
    </div>

      <!-- Reminders Tab -->
      <div id="remindersTab" class="tab-content">
        <div class="tab-inner">
          <div class="reminders-settings">
            <h3>Reminder Settings</h3>
            <p>Configure how and when you receive subscription reminders.</p>
          
          <div class="reminder-status">
            <div class="status-item">
              <div class="status-icon email" id="emailStatus">📧</div>
              <span>Email Notifications</span>
              <div class="status-indicator" id="emailIndicator">Not connected</div>
            </div>
            
            <div class="status-item">
              <div class="status-icon calendar" id="calendarStatus">📅</div>
              <span>Google Calendar</span>
              <div class="status-indicator" id="calendarIndicator">Not connected</div>
            </div>
            
            <div class="status-item">
              <div class="status-icon whatsapp" id="whatsappStatus">💬</div>
              <span>WhatsApp</span>
              <div class="status-indicator" id="whatsappIndicator">Not connected</div>
            </div>
          </div>
          
            <div class="reminder-actions">
              <button id="openReminderSettings" class="action-btn primary">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="3"/>
                  <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                </svg>
                Configure Reminders
              </button>
              
              <button id="testNotifications" class="action-btn secondary">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/>
                  <path d="M13.73 21a2 2 0 0 1-3.46 0"/>
                </svg>
                Test Notifications
              </button>
            </div>
          
            <div class="reminder-info">
              <h4>Quick Setup Tips:</h4>
              <ul>
                <li>Connect your email for professional reminder notifications</li>
                <li>Link Google Calendar to automatically create reminder events</li>
                <li>Set up WhatsApp for instant mobile notifications</li>
              </ul>
            </div>
          </div>
        </div>
      </div>

    <!-- Loading State -->
    <div id="loadingState" class="loading-state">
      <div class="spinner"></div>
      <p>Loading...</p>
    </div>

    <!-- Error State -->
    <div id="errorState" class="error-state hidden">
      <div class="error-icon">⚠️</div>
      <h3>Connection Error</h3>
      <p id="errorMessage">Unable to connect to your subscription tracker.</p>
      <button id="retryBtn" class="retry-btn">Retry</button>
    </div>

    <!-- Footer -->
    <footer class="footer">
      <button id="openAppBtn" class="footer-btn">Open Full App</button>
    </footer>

    <!-- Budget Alert Modal -->
    <div id="budgetModal" class="modal hidden">
      <div class="modal-content">
        <h3>Set Budget Alert</h3>
        <p>Get notified when your monthly subscription spending approaches your limit.</p>
        <div class="form-row">
          <input type="number" id="budgetAmount" placeholder="Monthly budget limit" step="0.01" min="0" />
        </div>
        <div class="modal-actions">
          <button id="saveBudgetBtn" class="save-btn">Set Alert</button>
          <button id="closeBudgetModal" class="cancel-btn">Cancel</button>
        </div>
      </div>
    </div>

    <!-- Share Modal -->
    <div id="shareModal" class="modal hidden">
      <div class="modal-content">
        <h3>Share Subscription Summary</h3>
        <p>Share your subscription insights with others.</p>
        <div class="share-options">
          <button id="shareTextBtn" class="share-btn">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
              <polyline points="14,2 14,8 20,8"/>
            </svg>
            Copy as Text
          </button>
          <button id="shareLinkBtn" class="share-btn">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/>
              <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/>
            </svg>
            Share Link
          </button>
        </div>
        <div class="modal-actions">
          <button id="closeShareModal" class="cancel-btn">Close</button>
        </div>
      </div>
    </div>
  </div>

  <script src="popup.js"></script>
  <script src="popup-form-validation.js"></script>
</body>
</html>
