<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Subscription Tracker</title>
  <link rel="stylesheet" href="popup.css">
</head>
<body>
  <div class="container">
    <!-- Header -->
    <header class="header">
      <div class="logo">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M3 3V21H21V3H3Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M9 9L15 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          <path d="M15 9L9 15" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <h1>SubTracker</h1>
      </div>
      <button id="settingsBtn" class="settings-btn" title="Settings">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 15A3 3 0 1 0 12 9A3 3 0 0 0 12 15Z" stroke="currentColor" stroke-width="2"/>
          <path d="M19.4 15A1.65 1.65 0 0 0 18 13.34A1.65 1.65 0 0 0 19.4 9A2.15 2.15 0 0 1 21.5 7A2.15 2.15 0 0 1 19.4 5A1.65 1.65 0 0 0 18 3.34A1.65 1.65 0 0 0 19.4 1A2.15 2.15 0 0 1 17 0A2.15 2.15 0 0 1 15.6 1A1.65 1.65 0 0 0 14.34 3.34A1.65 1.65 0 0 0 12 5A1.65 1.65 0 0 0 9.66 3.34A1.65 1.65 0 0 0 8.4 1A2.15 2.15 0 0 1 6 0A2.15 2.15 0 0 1 4.6 1A1.65 1.65 0 0 0 3.34 3.34A1.65 1.65 0 0 0 4.6 9A2.15 2.15 0 0 1 2.5 7A2.15 2.15 0 0 1 4.6 15A1.65 1.65 0 0 0 6 13.34A1.65 1.65 0 0 0 4.6 19A2.15 2.15 0 0 1 7 21A2.15 2.15 0 0 1 9.66 19A1.65 1.65 0 0 0 12 20.66A1.65 1.65 0 0 0 14.34 19A1.65 1.65 0 0 0 15.6 21A2.15 2.15 0 0 1 17 21A2.15 2.15 0 0 1 19.4 19A1.65 1.65 0 0 0 20.66 20.66A1.65 1.65 0 0 0 19.4 15Z" stroke="currentColor" stroke-width="2"/>
        </svg>
      </button>
    </header>

    <!-- Auth Section -->
    <div id="authSection" class="auth-section hidden">
      <div class="auth-form">
        <h2>Connect to Your Account</h2>
        <p class="auth-description">Enter your Subscription Tracker URL and API key to sync your data.</p>
        
        <div class="form-group">
          <label for="apiUrl">App URL:</label>
          <input type="url" id="apiUrl" placeholder="https://3b09af3c-f605-44fe-8597-73a8f24d40cc-00-2xkffllmc9j6n.kirk.replit.dev" />
        </div>
        
        <div class="form-group">
          <label for="apiKey">API Key:</label>
          <input type="password" id="apiKey" placeholder="dev-api-key" />
          <small><strong>Demo:</strong> Use "dev-api-key" for testing</small>
        </div>
        
        <button id="connectBtn" class="connect-btn">Connect Account</button>
      </div>
    </div>

    <!-- Main Content -->
    <div id="mainContent" class="main-content hidden">
      <!-- Navigation Tabs -->
      <div class="nav-tabs">
        <button class="nav-tab active" data-tab="dashboard">Dashboard</button>
        <button class="nav-tab" data-tab="calendar">Calendar</button>
        <button class="nav-tab" data-tab="insights">Insights</button>
        <button class="nav-tab" data-tab="reminders">Reminders</button>
      </div>

      <!-- Dashboard Tab -->
      <div id="dashboardTab" class="tab-content active">
        <!-- Stats Overview -->
        <div class="stats-section">
          <div class="stat-card">
            <div class="stat-value" id="totalCost">$0.00</div>
            <div class="stat-label">Monthly Total</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="activeCount">0</div>
            <div class="stat-label">Active Subs</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="upcomingCount">0</div>
            <div class="stat-label">Due Soon</div>
          </div>
        </div>

        <!-- Search and Filter -->
        <div class="search-section">
          <div class="search-bar">
            <input type="text" id="searchInput" placeholder="Search subscriptions..." />
            <button id="searchBtn" class="search-btn">
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"/>
                <path d="m21 21-4.35-4.35"/>
              </svg>
            </button>
          </div>
          <div class="filter-chips">
            <button class="filter-chip active" data-filter="all">All</button>
            <button class="filter-chip" data-filter="active">Active</button>
            <button class="filter-chip" data-filter="due-soon">Due Soon</button>
          </div>
        </div>

        <!-- Quick Actions -->
        <div class="actions-section">
          <button id="addSubBtn" class="action-btn primary">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M12 5V19" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <path d="M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
            Add Subscription
          </button>
          <button id="syncBtn" class="action-btn secondary">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M21 12A9 9 0 1 1 12 3" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
              <path d="M21 3V12H12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
            Sync Now
          </button>
        </div>

        <!-- Subscriptions List -->
        <div class="subscriptions-section">
          <div class="section-header">
            <h3>Your Subscriptions</h3>
            <button id="viewAllBtn" class="view-all-btn">View All</button>
          </div>
          <div id="subscriptionsList" class="subscriptions-list">
            <div class="loading-state">Loading subscriptions...</div>
          </div>
        </div>
      </div>

      <!-- Calendar Tab -->
      <div id="calendarTab" class="tab-content">
        <div class="calendar-header">
          <button id="prevMonth" class="calendar-nav">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="15,18 9,12 15,6"/>
            </svg>
          </button>
          <h3 id="calendarTitle">January 2025</h3>
          <button id="nextMonth" class="calendar-nav">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="9,18 15,12 9,6"/>
            </svg>
          </button>
        </div>
        
        <div class="calendar-grid">
          <div class="calendar-day-header">S</div>
          <div class="calendar-day-header">M</div>
          <div class="calendar-day-header">T</div>
          <div class="calendar-day-header">W</div>
          <div class="calendar-day-header">T</div>
          <div class="calendar-day-header">F</div>
          <div class="calendar-day-header">S</div>
        </div>
        
        <div id="calendarDays" class="calendar-days"></div>
        
        <div class="upcoming-section">
          <h4>Upcoming Renewals (Next 30 Days)</h4>
          <div id="upcomingRenewals" class="upcoming-list">
            <div class="loading-state">Loading upcoming renewals...</div>
          </div>
        </div>
      </div>

      <!-- Insights Tab -->
      <div id="insightsTab" class="tab-content">
        <div class="insights-section">
          <h3>Spending Analysis</h3>
          
          <div class="spending-chart">
            <div class="chart-header">
              <h4>Monthly Breakdown</h4>
              <div id="totalSpending" class="total-spending">$0.00</div>
            </div>
            <div id="categoryChart" class="category-chart"></div>
          </div>
          
          <div class="insights-cards">
            <div class="insight-card">
              <h4>Most Expensive</h4>
              <div id="mostExpensive" class="insight-value">-</div>
            </div>
            <div class="insight-card">
              <h4>Average Cost</h4>
              <div id="averageCost" class="insight-value">$0.00</div>
            </div>
            <div class="insight-card">
              <h4>This Year Total</h4>
              <div id="yearlyTotal" class="insight-value">$0.00</div>
            </div>
          </div>
          
          <div class="recommendations">
            <h4>Smart Recommendations</h4>
            <div id="recommendationsList" class="recommendations-list">
              <div class="loading-state">Analyzing your subscriptions...</div>
            </div>
          </div>
        </div>
      </div>


    <!-- Modal Overlay for Quick Add Form -->
    <div id="addFormModal" class="modal-overlay hidden">
      <div id="quickAddForm" class="quick-add-form">
        <div class="form-header">
          <h3>Add New Subscription</h3>
          <button id="closeAddForm" class="close-form-btn">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"/>
              <line x1="6" y1="6" x2="18" y2="18"/>
            </svg>
          </button>
        </div>
        
        <div class="form-content">
          <div class="form-tabs">
            <button class="form-tab active" data-form-tab="basic">Basic Info</button>
            <button class="form-tab" data-form-tab="advanced">Advanced</button>
          </div>
          
          <div id="basicFormTab" class="form-tab-content active">
            <div class="form-row">
              <input type="text" id="subName" placeholder="Service name" required />
              <input type="number" id="subCost" placeholder="Cost" step="0.01" min="0" required />
            </div>
            <div class="form-row">
              <select id="subCategory">
                <option value="Entertainment">Entertainment</option>
                <option value="Productivity">Productivity</option>
                <option value="Music">Music</option>
                <option value="Cloud Storage">Cloud Storage</option>
                <option value="Software">Software</option>
                <option value="News">News</option>
                <option value="Fitness">Fitness</option>
                <option value="Gaming">Gaming</option>
                <option value="Education">Education</option>
                <option value="Other">Other</option>
              </select>
              <select id="subCycle">
                <option value="monthly">Monthly</option>
                <option value="yearly">Yearly</option>
                <option value="weekly">Weekly</option>
              </select>
            </div>
            <div class="form-row">
              <input type="date" id="nextBillingDate" />
              <label class="checkbox-label">
                <input type="checkbox" id="isActive" checked />
                <span>Active subscription</span>
              </label>
            </div>
          </div>
          
          <div id="advancedFormTab" class="form-tab-content">
            <div class="form-row">
              <input type="email" id="subEmail" placeholder="Account email (optional)" />
              <input type="url" id="subUrl" placeholder="Website URL (optional)" />
            </div>
            <div class="form-row">
              <input type="text" id="subDescription" placeholder="Description (optional)" />
            </div>
            <div class="form-row">
              <select id="subPriority">
                <option value="low">Low Priority</option>
                <option value="medium">Medium Priority</option>
                <option value="high">High Priority</option>
                <option value="essential">Essential</option>
              </select>
              <input type="number" id="subBudgetLimit" placeholder="Budget limit (optional)" step="0.01" min="0" />
            </div>
            <div class="form-row">
              <label class="checkbox-label">
                <input type="checkbox" id="sendReminders" checked />
                <span>Send renewal reminders</span>
              </label>
              <label class="checkbox-label">
                <input type="checkbox" id="trackUsage" />
                <span>Track usage patterns</span>
              </label>
            </div>
          </div>
          
          <div class="form-actions">
            <button id="saveSubBtn" class="save-btn">Save Subscription</button>
            <button id="cancelSubBtn" class="cancel-btn">Cancel</button>
          </div>
        </div>
      </div>
    </div>

      <!-- Reminders Tab -->
      <div id="remindersTab" class="tab-content">
        <div class="tab-inner">
          <div class="reminders-settings">
            <h3>Reminder Settings</h3>
            <p>Configure how and when you receive subscription reminders.</p>
          
          <div class="reminder-status">
            <div class="status-item">
              <div class="status-icon email" id="emailStatus">📧</div>
              <span>Email Notifications</span>
              <div class="status-indicator" id="emailIndicator">Not connected</div>
            </div>
            
            <div class="status-item">
              <div class="status-icon calendar" id="calendarStatus">📅</div>
              <span>Google Calendar</span>
              <div class="status-indicator" id="calendarIndicator">Not connected</div>
            </div>
            
            <div class="status-item">
              <div class="status-icon whatsapp" id="whatsappStatus">💬</div>
              <span>WhatsApp</span>
              <div class="status-indicator" id="whatsappIndicator">Not connected</div>
            </div>
          </div>
          
            <div class="reminder-actions">
              <button id="openReminderSettings" class="action-btn primary">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="3"/>
                  <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1 1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                </svg>
                Configure Reminders
              </button>
              
              <button id="testNotifications" class="action-btn secondary">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/>
                  <path d="M13.73 21a2 2 0 0 1-3.46 0"/>
                </svg>
                Test Notifications
              </button>
            </div>
          
            <div class="reminder-info">
              <h4>Quick Setup Tips:</h4>
              <ul>
                <li>Connect your email for professional reminder notifications</li>
                <li>Link Google Calendar to automatically create reminder events</li>
                <li>Set up WhatsApp for instant mobile notifications</li>
              </ul>
            </div>
          </div>
        </div>
      </div>

    <!-- Loading State -->
    <div id="loadingState" class="loading-state">
      <div class="spinner"></div>
      <p>Loading...</p>
    </div>

    <!-- Error State -->
    <div id="errorState" class="error-state hidden">
      <div class="error-icon">⚠️</div>
      <h3>Connection Error</h3>
      <p id="errorMessage">Unable to connect to your subscription tracker.</p>
      <button id="retryBtn" class="retry-btn">Retry</button>
    </div>

    <!-- Footer -->
    <footer class="footer">
      <button id="openAppBtn" class="footer-btn">Open Full App</button>
    </footer>

    <!-- Budget Alert Modal -->
    <div id="budgetModal" class="modal hidden">
      <div class="modal-content">
        <h3>Set Budget Alert</h3>
        <p>Get notified when your monthly subscription spending approaches your limit.</p>
        <div class="form-row">
          <input type="number" id="budgetAmount" placeholder="Monthly budget limit" step="0.01" min="0" />
        </div>
        <div class="modal-actions">
          <button id="saveBudgetBtn" class="save-btn">Set Alert</button>
          <button id="closeBudgetModal" class="cancel-btn">Cancel</button>
        </div>
      </div>
    </div>

    <!-- Share Modal -->
    <div id="shareModal" class="modal hidden">
      <div class="modal-content">
        <h3>Share Subscription Summary</h3>
        <p>Share your subscription insights with others.</p>
        <div class="share-options">
          <button id="shareTextBtn" class="share-btn">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
              <polyline points="14,2 14,8 20,8"/>
            </svg>
            Copy as Text
          </button>
          <button id="shareLinkBtn" class="share-btn">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"/>
              <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"/>
            </svg>
            Share Link
          </button>
        </div>
        <div class="modal-actions">
          <button id="closeShareModal" class="cancel-btn">Close</button>
        </div>
      </div>
    </div>
  </div>

  <script src="popup.js"></script>
</body>
</html>